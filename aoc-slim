#!/usr/bin/env -S emacs --script
;; -*- mode: emacs-lisp; lexical-binding: t; -*-

(require 'cl-lib)

(dolist (dir (cl-remove-if-not
              #'file-directory-p
              (directory-files
               (expand-file-name "~/.emacs.d/elpa/28.2/develop")
               'full)))
  (add-to-list 'load-path dir))

(add-to-list
 'load-path
 (file-name-directory
  (cond
   (load-in-progress
    load-file-name)
   ((and (boundp 'byte-compile-current-file)
         byte-compile-current-file)
    byte-compile-current-file)
   (t
    (buffer-file-name)))))

(require 'aoc-emacs)

(when (< (length argv) 1)
  (error "Usage: %s <file>+" load-file-name))

(dolist (filename argv)
  (let ((inhibit-message t)
        (make-backup-files nil))
    (with-current-buffer (aoc-slim-buffer (find-file-existing filename))
      (write-file (expand-file-name
                   (concat (file-name-base filename) "-slim.el"))))))
